# üåÄ –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≥–æ—Ä—É—Ç–∏–Ω –≤ Go

–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è **–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏—Ö —Å–ø–æ—Å–æ–±–æ–≤ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≥–æ—Ä—É—Ç–∏–Ω**.
–ö–∞–∂–¥—ã–π —Å–ø–æ—Å–æ–± –≤—ã–Ω–µ—Å–µ–Ω –≤ –æ—Ç–¥–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è.

---

## üß© –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã

1. **–û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ —É—Å–ª–æ–≤–∏—é**
   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞—Ç–æ–º–∞—Ä–Ω—ã–π —Ñ–ª–∞–≥ (`atomic.Int32`), —á—Ç–æ–±—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ü–∏–∫–ª.

2. **–û—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ –∫–∞–Ω–∞–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
   –ó–∞–∫—Ä—ã—Ç–∏–µ –∫–∞–Ω–∞–ª–∞ `stopCh` —Å–ª—É–∂–∏—Ç —Å–∏–≥–Ω–∞–ª–æ–º –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ä–∞–±–æ—Ç—É.

3. **–û—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ `context.WithCancel`**
   –ü–µ—Ä–µ–¥–∞—á–∞ —Å–∏–≥–Ω–∞–ª–∞ –æ—Ç–º–µ–Ω—ã –≤—Å–µ–º –∑–∞–≤–∏—Å–∏–º—ã–º –≥–æ—Ä—É—Ç–∏–Ω–∞–º —á–µ—Ä–µ–∑ `ctx.Done()`.

4. **–ê–≤—Ç–æ–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ `context.WithTimeout`**
   –ì–æ—Ä—É—Ç–∏–Ω–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ —Ç–∞–π–º–∞—É—Ç–∞.

5. **–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ `runtime.Goexit()`**
   –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç *—Ç–µ–∫—É—â—É—é* –≥–æ—Ä—É—Ç–∏–Ω—É –±–µ–∑ –ø–∞–Ω–∏–∫–∏.

6. **–ì—Ä–∞—Ü–∏–æ–∑–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–æ—Ä–∫–µ—Ä–∞ (—á–µ—Ä–µ–∑ –∑–∞–∫—Ä—ã—Ç–∏–µ –∫–∞–Ω–∞–ª–∞ –∑–∞–¥–∞—á)**
   –ì–æ—Ä—É—Ç–∏–Ω–∞ —á–∏—Ç–∞–µ—Ç –∑–∞–¥–∞–Ω–∏—è –∏–∑ –∫–∞–Ω–∞–ª–∞ `jobs` –∏ –≤—ã—Ö–æ–¥–∏—Ç –ø–æ—Å–ª–µ –µ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è.

---

## üí° –ö–∞–∫–æ–π —Å–ø–æ—Å–æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –ø—Ä–æ–¥–∞–∫—à–Ω–µ

| –ü–æ–¥—Ö–æ–¥                    | –ì–¥–µ –ø—Ä–∏–º–µ–Ω—è—Ç—å                                  | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                            |
| ------------------------- | ---------------------------------------------- | -------------------------------------- |
| **–ö–∞–Ω–∞–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**     | –ø—Ä–æ—Å—Ç—ã–µ —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏                         | –õ–µ–≥–∫–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å, –∏–¥–∏–æ–º–∞—Ç–∏—á–Ω–æ –¥–ª—è Go  |
| **`context.Context`**     | —Å–µ—Ç–µ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã, API, –≥–æ—Ä—É—Ç–∏–Ω—ã —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ | –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω-–∫–æ–¥–∞        |
| **–ó–∞–∫—Ä—ã—Ç–∏–µ –∫–∞–Ω–∞–ª–∞ –∑–∞–¥–∞—á** | worker-–ø—É–ª—ã, –ø–∞–π–ø–ª–∞–π–Ω—ã                         | –ü–æ–∑–≤–æ–ª—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ ¬´–¥–æ—á–∏—Ç–∞—Ç—å¬ª –æ—á–µ—Ä–µ–¥—å |
| **–§–ª–∞–≥ / `Goexit()`**     | –æ—Ç–ª–∞–¥–∫–∞, –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è, –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–¥     | –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—Ä–æ–¥–∞–∫—à–Ω–µ            |


## üíª –ö–æ–¥

```go
package main

import (
	"context"
	"fmt"
	"runtime"
	"sync"
	"sync/atomic"
	"time"
)

func main() {
	fmt.Println("1 –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ —É—Å–ª–æ–≤–∏—é")
	stopByCondition()
	fmt.Println()

	fmt.Println("2 –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ –∫–∞–Ω–∞–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è")
	stopByCloseChannel()
	fmt.Println()

	fmt.Println("3 –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ context")
	stopByContextCancel()
	fmt.Println()

	fmt.Println("4 –ê–≤—Ç–æ–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ context")
	stopByContextTimeout()
	fmt.Println()

	fmt.Println("5 –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ runtime.Goexit")
	stopByGoexit()
	fmt.Println()

	fmt.Println("6 –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏–µ–º –∫–∞–Ω–∞–ª–∞ –∑–∞–¥–∞—á")
	stopWorkerByClosingJobs()
	fmt.Println()

	fmt.Println("End")
}

// 1) –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ —É—Å–ª–æ–≤–∏—é
// –ò—Å–ø–æ–ª—å–∑—É–µ–º –∞—Ç–æ–º–∞—Ä–Ω—ã–π —Ñ–ª–∞–≥ —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –≥–æ–Ω–∫–∏ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ –∏–∑ main –∏ —á—Ç–µ–Ω–∏–∏ –≤ –≥–æ—Ä—É—Ç–∏–Ω–µ
func stopByCondition() {
	var stop atomic.Int32
	var wg sync.WaitGroup
	wg.Add(1)
	go func() {
		defer wg.Done()
		for {
			if stop.Load() == 1 {
				fmt.Println("–≥–æ—Ä–æ—É—Ç–∏–Ω–∞ 1: –ø–æ–ª—É—á–µ–Ω —Ñ–ª–∞–≥ –≤—ã—Ö–æ–∂—É ")
				return
			}
			fmt.Println("–≥–æ—Ä–æ—É—Ç–∏–Ω–∞ 1: —Ä–∞–±–æ—Ç–∞—é")
			time.Sleep(300 * time.Millisecond)
		}
	}()
	time.Sleep(1 * time.Second)
	stop.Store(1)
	wg.Wait()
}

// 2) –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ –∫–∞–Ω–∞–ª —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
func stopByCloseChannel() {
	stopCh := make(chan struct{})
	var wg sync.WaitGroup
	wg.Add(1)
	go func() {
		defer wg.Done()
		for {
			select {
			case <-stopCh:
				fmt.Println("–≥–æ—Ä–æ—É—Ç–∏–Ω–∞ 2: –ø–æ–ª—É—á–µ–Ω —Å–∏–≥–Ω–∞–ª –≤ stopCh –≤—ã—Ö–æ–∂—É")
				return
			default:
				fmt.Println("–≥–æ—Ä–æ—É—Ç–∏–Ω–∞ 2: —Ä–∞–±–æ—Ç–∞—é...")
				time.Sleep(300 * time.Millisecond)
			}
		}
	}()
	time.Sleep(1 * time.Second)
	close(stopCh)
	wg.Wait()
}

// 3) –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —á–µ—Ä–µ–∑ context.WithCancel
func stopByContextCancel() {
	ctx, cancel := context.WithCancel(context.Background())
	var wg sync.WaitGroup
	wg.Add(1)

	go func() {
		defer wg.Done()
		for {
			select {
			case <-ctx.Done():
				fmt.Println("–≥–æ—Ä–æ—É—Ç–∏–Ω–∞ 3: ctx.Done() –≤—ã—Ö–æ–∂—É")
				return
			default:
				fmt.Println("–≥–æ—Ä–æ—É—Ç–∏–Ω–∞ 3: —Ä–∞–±–æ—Ç–∞—é...")
				time.Sleep(300 * time.Millisecond)
			}
		}
	}()

	time.Sleep(1 * time.Second)
	cancel()
	wg.Wait()
}

// 4) –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ —Ç–∞–π–º–∞—É—Ç—É —á–µ—Ä–µ–∑ context.WithTimeout
func stopByContextTimeout() {
	ctx, cancel := context.WithTimeout(context.Background(), 1200*time.Millisecond)
	defer cancel()
	var wg sync.WaitGroup
	wg.Add(1)

	go func() {
		defer wg.Done()
		for {
			select {
			case <-ctx.Done():
				fmt.Println("–≥–æ—Ä–æ—É—Ç–∏–Ω–∞ 4: —Ç–∞–π–º–∞—É—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤—ã—Ö–æ–∂—É")
				return
			default:
				fmt.Println("–≥–æ—Ä–æ—É—Ç–∏–Ω–∞ 4: —Ä–∞–±–æ—Ç–∞—é...")
				time.Sleep(300 * time.Millisecond)
			}
		}
	}()

	wg.Wait()
}

// 5) –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–µ–∫—É—â–µ–π –≥–æ—Ä—É—Ç–∏–Ω—ã —á–µ—Ä–µ–∑ runtime.Goexit()
func stopByGoexit() {
	var wg sync.WaitGroup
	wg.Add(1)

	go func() {
		defer wg.Done()
		fmt.Println("–≥–æ—Ä–æ—É—Ç–∏–Ω–∞ 5: —Å—Ç–∞—Ä—Ç")
		time.Sleep(700 * time.Millisecond)
		fmt.Println("–≥–æ—Ä–æ—É—Ç–∏–Ω–∞ 5: –≤—ã–∑—ã–≤–∞—é runtime.Goexit()")
		runtime.Goexit()
	}()

	wg.Wait()
	fmt.Println("–≥–æ—Ä—É—Ç–∏–Ω–∞ 5: –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å —á–µ—Ä–µ–∑ Goexit()")
}

// 6) –ì—Ä–∞—Ü–∏–æ–∑–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–æ—Ä–∫–µ—Ä–∞ —á–µ—Ä–µ–∑ –∑–∞–∫—Ä—ã—Ç–∏–µ –∫–∞–Ω–∞–ª–∞ –∑–∞–¥–∞—á
func stopWorkerByClosingJobs() {
	jobs := make(chan int)
	var wg sync.WaitGroup
	wg.Add(1)

	go func() {
		defer wg.Done()
		for j := range jobs {
			fmt.Printf("–≥–æ—Ä—É—Ç–∏–Ω–∞ 6: –æ–±—Ä–∞–±–æ—Ç–∞–ª –∑–∞–¥–∞—á—É %d\n", j)
			time.Sleep(200 * time.Millisecond)
		}
		fmt.Println("–≥–æ—Ä—É—Ç–∏–Ω–∞ 6: –∫–∞–Ω–∞–ª jobs –∑–∞–∫—Ä—ã—Ç –≤—ã—Ö–æ–∂—É")
	}()

	for i := 1; i <= 5; i++ {
		jobs <- i
	}
	close(jobs)
	wg.Wait()
}
```
